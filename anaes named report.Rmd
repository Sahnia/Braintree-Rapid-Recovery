---
fontsize: 10pt
header-includes:
- \usepackage{booktabs,calc}
- \usepackage{lmodern}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \usepackage{multirow}
- \usepackage{xcolor}
- \renewcommand{\contentsname}{Table of Contents}
- \usepackage{graphicx}
- \setlength\headheight{28pt}
- \fancyfoot[LE,RO]{\thepage}
- \renewcommand{\headrulewidth}{0.4pt}
- \renewcommand{\footrulewidth}{0.4pt}
mainfont: Crimson
output:
  word_document:
    toc: yes
    toc_depth: '3'
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '3'
  pdf_document:
    latex_engine: xelatex
    number_sections: yes
    toc: yes
    toc_depth: 3
papersize: a4
geometry: "left=1cm,right=1cm,top=2cm,bottom=2.5cm"
always_allow_html: true
---

```{r setup, warning=FALSE, message=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.pos= "h", dpi=300, warning=FALSE, message=FALSE, fig.height=3.5, fig.width=7, fig.align='centre')

library(here)
library(knitr)
set_here()

source("source/clean.R")
source("source/theme.R")
```

\pagebreak



\begin {center}

\definecolor{pqipred}{HTML}{931E2F}

$\color{pqipred}\Huge{\text{Elective Arthroplasty at Braintree Hospital}}$ 

$\color{black}\LARGE{\text{`r format(Sys.Date()," %d %B %Y")`}}$ 

\end {center}


```{r introduction, message=FALSE, warning=FALSE, include=FALSE}
start_date <- format(min(audit_data$datetime_of_surgery, na.rm = TRUE), "%d %B %Y")
end_date <- format(max(audit_data$datetime_of_surgery, na.rm = TRUE), "%d %B %Y")

```

# Introduction

This report includes patients who had an elective arthroplasty at Braintree community Hospital. The data for this report was collected by the team at Braintree Community Hospiyal The dataset that this report is based on the `r nrow(audit_data)` discharged patients who had a procedure  between `r start_date` and  `r end_date`. 

This report was produced on: `r format(Sys.time(), "%d %B %Y %H:%M")`.

```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}

source("source/procedures.R")

```

## Anaesthetists

Between `r start_date` and  `r end_date` `r nlevels(audit_data$anaethetist)` different anaesthetists provided anaesthesia for at least 1 arthoplasty at BCH. The median being number of anaesthetics provided for athroplasties was  `r median(anaes$n)`  per month with an interquartile range of `r IQR(anaes$n)`. Figure 1 demonstrates the number of anaesthetics performed at BCH each chart represents an individual  anaesthetist . 

```{r echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}

named_anaes_facet + labs(title= "Fig 1: Number of anaesthetics performed at BCH per month by each anaestist")

```

## Working together

Figure 2 below is a tree map. Each colour represents a different surgeon the size of the rectangle represents the number of arthroplasties performed by each one. The subdivision of each rectangle represents each anaesthetist they have worked with. The size of the sub division represents the number of arthroplasties performed by them together. Overall the tree map demonstrates the number of anaesthetists each surgeon has worked and the number of arthroplasties they have performed together as a team. 



```{r echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
source("source/times.R")
named_anaes_work_tree + labs(title= "Fig 2: Treemap of working relationships")

```


# Length of Stay

Post operative length of stay has a direct impact on the number of bed days required and therefore the amount of resources need to support the pathway. 

The figure below is the median length of stay for each type of arthroplasty by anaesthetist The labels show the number of patients who had that type of procedure by each individual



```{r echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
source("source/times.R")
named_LOS_anaes
```


# R Markdown

This report was produced using R Markdown. Markdown is a simple formatting syntax for authoring HTML, PDF, and Power point documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>. 

